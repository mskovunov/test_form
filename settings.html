<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ñ€Ğ¾Ğ·ÑĞ¸Ğ»ĞºĞ¸</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        
        <!-- ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ¼ĞµĞ½Ñ -->
        <button class="menu-button" onclick="toggleMenu()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M4 6H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M4 12H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>

        <div class="form-wrapper">

            <!-- Ğ‘Ğ¾ĞºĞ¾Ğ²Ğ¾Ğµ Ğ¼ĞµĞ½Ñ (Ğ£Ğ±Ñ€Ğ°Ğ½Ğ¾, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸Ğ·Ğ±ĞµĞ¶Ğ°Ñ‚ÑŒ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ĞºĞ¾Ğ´Ğ°) -->
            <div class="side-menu" id="sideMenu">
                <button class="close-button" onclick="toggleMenu()">âŒ</button>
                <ul>
                    <li><a href="index.html">ğŸ  Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğ°</a></li> 
                    <li><a href="history.html">ğŸ“œ Ğ†ÑÑ‚Ğ¾Ñ€Ñ–Ñ</a></li> 
                    <li><a href="stats.html">ğŸ“ˆ Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°</a></li>
                    <li><a href="settings.html">âš™ï¸ ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ</a></li>
                    <li><a href="#" onclick="closeWebView()">ğŸšª Ğ’Ğ¸Ñ…Ñ–Ğ´</a></li>
                </ul>
                <button type="button" class="theme-toggle" onclick="toggleTheme()">ğŸŒ“ Ğ—Ğ¼Ñ–Ğ½Ğ¸Ñ‚Ğ¸ Ñ‚ĞµĞ¼Ñƒ</button>
            </div>


            <!-- ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğµ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ -->
            <h2>Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ– Ğ½Ğ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ</h2>

            <!-- ĞĞšĞšĞĞ Ğ”Ğ•ĞĞ 1: ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ ÑĞ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½ÑŒ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ² -->
            <div class="accordion-item">
                <div class="accordion-header" id="configHeader" onclick="toggleAccordion('configContent')">
                    ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ ÑĞ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½ÑŒ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ² ğŸ””
                    <span class="accordion-icon">â–¼</span>
                </div>
                <div class="accordion-content open" id="configContent">
                    <div id="configTableContainer" style="text-align: left;">
                        <!-- Ğ¡ÑĞ´Ğ° Ğ±ÑƒĞ´ĞµÑ‚ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ° Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° -->
                    </div>
                    <!-- ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ Ğ´Ğ»Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° (ĞŸĞ•Ğ Ğ•ĞœĞ•Ğ©Ğ•Ğ ĞŸĞĞ” Ğ¢ĞĞ‘Ğ›Ğ˜Ğ¦Ğ£) -->
                    <div id="configStatus" class="status-message" style="text-align: center; margin-top: 20px;"></div>
                </div>
            </div>
            <!-- ĞšĞĞĞ•Ğ¦ ĞĞšĞšĞĞ Ğ”Ğ•ĞĞĞ 1 -->
            
            <!-- ĞĞĞ’Ğ«Ğ™ ĞĞšĞšĞĞ Ğ”Ğ•ĞĞ 2: Email ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ² -->
            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion('emailContent')">
                    Email ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ² ğŸ“§
                    <span class="accordion-icon">â–¼</span>
                </div>
                <!-- Ğ£Ğ±Ñ€Ğ°Ğ½ ĞºĞ»Ğ°ÑÑ 'open', Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ±Ğ»Ğ¾Ğº Ğ±Ñ‹Ğ» ÑĞ²ĞµÑ€Ğ½ÑƒÑ‚ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ -->
                <div class="accordion-content" id="emailContent">
                    <div id="emailListContainer">
                        <p style="text-align: center; color: var(--text-color);">Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº email'Ñ–Ğ² Ğ±ÑƒĞ´Ğµ Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ¾ Ñ‚ÑƒÑ‚.</p>
                        <!-- Ğ¡ÑĞ´Ğ° Ğ±ÑƒĞ´ĞµÑ‚ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½ ÑĞ¿Ğ¸ÑĞ¾Ğº email'Ğ¾Ğ² -->
                    </div>
                </div>
            </div>
            <!-- ĞšĞĞĞ•Ğ¦ ĞĞšĞšĞĞ Ğ”Ğ•ĞĞĞ 2 -->
            
            <!-- Ğ’ĞµÑ€ÑĞ¸Ñ ÑĞ±Ğ¾Ñ€ĞºĞ¸ -->
            <p id="buildVersion" style="margin-top: 20px; font-size: 0.75rem; color: #999; text-align: center;"></p>
            
        </div>
    </div>

    <script>
        const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbxiFpwrkbINal0wGhPxMy0wd452HF3Q64yPqXyntLG9HC7gIus6zY2hQoqrcWH_EROf/exec';
        
        // --- Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ ---
        function toggleTheme() {
            const isDark = document.body.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        // ĞĞĞ’ĞĞ¯ Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ¯: ĞŸĞ»Ğ°Ğ²Ğ½Ğ¾Ğµ ÑĞ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ/Ñ€Ğ°Ğ·Ğ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ
        function toggleAccordion(contentId) {
            const content = document.getElementById(contentId);
            const header = content.previousElementSibling; // header Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑÑ Ğ¿ĞµÑ€ĞµĞ´ content
            const icon = header.querySelector('.accordion-icon');
            
            // Ğ•ÑĞ»Ğ¸ Ğ°ĞºĞºĞ¾Ñ€Ğ´ĞµĞ¾Ğ½ Ğ·Ğ°ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ, ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ° ÑĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ (Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ configContent)
            if (contentId === 'configContent' && content.classList.contains('open')) {
                const statusDiv = document.getElementById('configStatus');
                statusDiv.style.display = 'none';
            }

            content.classList.toggle('open');
            header.classList.toggle('active');

            if (content.classList.contains('open')) {
                // Ğ Ğ°Ğ·Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ: ÑƒÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ max-height Ğ½Ğ° Ñ„Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºÑƒÑ Ğ²Ñ‹ÑĞ¾Ñ‚Ñƒ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ° + Ğ‘Ğ£Ğ¤Ğ•Ğ 
                // Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ±ÑƒÑ„ĞµÑ€ 50px Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿Ğ°ÑĞ°
                content.style.maxHeight = (content.scrollHeight + 50) + "px"; 
                icon.innerHTML = 'â–²';
            } else {
                // Ğ¡Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ
                content.style.maxHeight = '0';
                icon.innerHTML = 'â–¼';
            }
        }

        function toggleMenu() {
            const menu = document.getElementById("sideMenu");
            menu.classList.toggle("open");
        }
        
        function closeWebView() {
            console.log("Attempting to close WebView...");
            if (typeof Android !== 'undefined' && Android.closeApp) {
                Android.closeApp();
            } else {
                console.warn("Native Android closeApp interface not found. Cannot close application.");
            }
        }
        
        // --- Ğ£Ğ”ĞĞ›Ğ•ĞĞ hideLoading() ---
        
        /* --- Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜: ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Email Ğ¸ PUSH --- */
        
        // --- ĞĞ±Ñ‰Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ğ½Ğ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ---
        async function updateConfigStatus(sheetRow, currentFlag, targetColumn, event) {
            // targetColumn: 5 Ğ´Ğ»Ñ Email (E) Ğ¸Ğ»Ğ¸ 6 Ğ´Ğ»Ñ PUSH (F)
            
            // ĞŸÑ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ ĞºĞ»Ğ¸ĞºĞ° Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ€Ğ°Ğ·
Â  Â  Â  Â  Â  Â  if (event.target.classList.contains('status-loading')) return;

Â  Â  Â  Â  Â  Â  const statusDiv = document.getElementById('configStatus');
Â  Â  Â  Â  Â  Â  const newStatus = currentFlag === '1' ? '0' : '1';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Ğ’ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ½Ğ° ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğµ
Â  Â  Â  Â  Â  Â  const indicator = event.target;
Â  Â  Â  Â  Â  Â  const originalHTML = indicator.innerHTML;
Â  Â  Â  Â  Â  Â  indicator.innerHTML = 'ğŸ”„';
Â  Â  Â  Â  Â  Â  indicator.classList.add('status-loading');
Â  Â  Â  Â  Â  Â Â 
            // Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ: Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ¸Ğ¼ ÑĞ¿Ğ¸Ğ½Ğ½ĞµÑ€ + Ñ‚ĞµĞºÑÑ‚
            statusDiv.innerHTML = `<div class="inline-spinner-wrapper"><div class="inline-spinner"></div> ĞĞ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑÑƒ Ñ€ÑĞ´ĞºĞ° ${sheetRow} Ñƒ ĞºĞ¾Ğ»Ğ¾Ğ½Ñ†Ñ– ${targetColumn}...</div>`;
            // Ğ’Ğ°Ğ¶Ğ½Ğ¾: Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ, ĞºĞ¾Ğ³Ğ´Ğ° Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµĞ¼ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ
Â  Â  Â  Â  Â  Â  statusDiv.style.display = 'block';

            // ĞĞĞ’ĞĞ•: ĞŸĞµÑ€ĞµÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ²Ñ‹ÑĞ¾Ñ‚Ñƒ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑƒÑ‡ĞµÑÑ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ±Ğ»Ğ¾Ğº ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
            const content = document.getElementById('configContent');
            if (content && content.classList.contains('open')) {
                // ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿ĞµÑ€ĞµÑ€Ğ°ÑÑ‡ĞµÑ‚ + Ğ±ÑƒÑ„ĞµÑ€ 50px
                content.style.maxHeight = (content.scrollHeight + 50) + "px"; 
            }

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const formData = new FormData();
Â  Â  Â  Â  Â  Â  Â  Â  formData.append('updateConfig', '1');
Â  Â  Â  Â  Â  Â  Â  Â  formData.append('row', sheetRow);Â 
Â  Â  Â  Â  Â  Â  Â  Â  formData.append('status', newStatus);
                // ĞĞĞ’ĞĞ•: ĞŸĞµÑ€ĞµĞ´Ğ°ĞµĞ¼ Ğ² GAS Ğ½Ğ¾Ğ¼ĞµÑ€ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ¸ Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ
                formData.append('column', targetColumn); 

Â  Â  Â  Â  Â  Â  Â  Â  const resp = await fetch(WEBAPP_URL, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: formData
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const responseText = await resp.text();

Â  Â  Â  Â  Â  Â  Â  Â  if (responseText.includes('Success')) {
                    // Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ: Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ¸Ğ¼ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸ + Ñ‚ĞµĞºÑÑ‚
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.innerHTML = 'âœ… Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ ÑƒÑĞ¿Ñ–ÑˆĞ½Ğ¾.';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ loadConfig, Ñ‚Ğ°Ğº ĞºĞ°Ğº Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ½Ğ° Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚ Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Config
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await loadConfig();Â 
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(responseText);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.innerHTML = `<p style="color: var(--status-error);">âš ï¸ ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ: ${err.message || 'ĞĞµĞ²Ñ–Ğ´Ğ¾Ğ¼Ğ° Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ°'}</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  console.error('ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° POST-Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñƒ:', err);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ĞÑ‚ĞºĞ°Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ UI Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞµ
Â  Â  Â  Â  Â  Â  Â  Â  indicator.innerHTML = originalHTML;
Â  Â  Â  Â  Â  Â  Â  Â  indicator.classList.remove('status-loading');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Ğ¡ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ñ‡ĞµÑ€ĞµĞ· ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ
Â  Â  Â  Â  Â  Â  setTimeout(() => { 
                statusDiv.style.display = 'none'; 
                // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ²Ñ‹ÑĞ¾Ñ‚Ñƒ Ğ°ĞºĞºĞ¾Ñ€Ğ´ĞµĞ¾Ğ½Ğ° Ğ¿Ğ¾ÑĞ»Ğµ ÑĞºÑ€Ñ‹Ñ‚Ğ¸Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
                if (content && content.classList.contains('open')) {
                    // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ‘Ğ£Ğ¤Ğ•Ğ Ğ
                    content.style.maxHeight = (content.scrollHeight + 50) + "px"; 
                }
            }, 3000);
Â  Â  Â  Â  }
        
        // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ¸ "ĞÑ‚Ñ€Ğ¸Ğ¼ÑƒĞ²Ğ°Ñ‚Ğ¸ Email" (ĞšĞ¾Ğ»Ğ¾Ğ½ĞºĞ° E, Ğ¸Ğ½Ğ´ĞµĞºÑ 5)
        async function toggleEmailStatus(sheetRow, currentFlag, event) {
            await updateConfigStatus(sheetRow, currentFlag, 5, event);
        }

        // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ¸ "ĞÑ‚Ñ€Ğ¸Ğ¼ÑƒĞ²Ğ°Ñ‚Ğ¸ PUSH" (ĞšĞ¾Ğ»Ğ¾Ğ½ĞºĞ° F, Ğ¸Ğ½Ğ´ĞµĞºÑ 6)
        async function togglePushStatus(sheetRow, currentFlag, event) {
            await updateConfigStatus(sheetRow, currentFlag, 6, event);
        }
        /* --- ĞšĞĞĞ•Ğ¦ ĞĞĞ’Ğ«Ğ¥ Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ™ --- */

        // --- ĞĞĞ’ĞĞ¯ Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ¯: Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ÑĞ¿Ğ¸ÑĞºĞ° email'Ğ¾Ğ² (Ğ’ĞĞ¡Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•ĞĞ Ğ˜ĞĞ”Ğ˜ĞšĞĞ¦Ğ˜Ğ¯) ---
        async function loadEmailList() {
            const container = document.getElementById('emailListContainer');
            
            // Ğ’ĞĞ¡Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•ĞĞ: Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ÑĞ¾ ÑĞ¿Ğ¸Ğ½Ğ½ĞµÑ€Ğ¾Ğ¼
            container.innerHTML = `
                <p style="text-align: center; color: var(--text-color);">
                    <div class="inline-spinner-wrapper"><div class="inline-spinner"></div> Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ ÑĞ¿Ğ¸ÑĞºÑƒ email'Ñ–Ğ²...</div>
                </p>`;
            
            // Ğ˜Ğ¼Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ğ·Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚Ğµ Ğ½Ğ° Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ fetch Ğº GAS)
            await new Promise(resolve => setTimeout(resolve, 800)); 
            
            // Ğ—ĞĞ“Ğ›Ğ£Ğ¨ĞšĞ Ğ”ĞĞĞĞ«Ğ¥
            const mockEmails = [
                { user: "ĞŸĞµÑ‚Ñ€Ğ¾ Ğš.", email: "petro.k@example.com", department: "ĞŸÑ€Ğ¾Ğ´Ğ°Ğ¶Ñ–" },
                { user: "ĞĞ»ĞµĞ½Ğ° Ğ¡.", email: "olena.s@example.com", department: "Ğ Ğ¾Ğ·Ñ€Ğ¾Ğ±ĞºĞ°" },
                { user: "Ğ†Ğ²Ğ°Ğ½ Ğœ.", email: "ivan.m@example.com", department: "ĞĞ´Ğ¼Ñ–Ğ½" },
                { user: "ĞœĞ°Ñ€Ñ–Ñ Ğ’.", email: "maria.v@example.com", department: "ĞœĞ°Ñ€ĞºĞµÑ‚Ğ¸Ğ½Ğ³" }
            ];

            let html = `
                <div class="table-scroll">
                <table class="config-table">
                    <thead>
                        <tr>
                            <th>Ğ†Ğ¼'Ñ</th>
                            <th>Email</th>
                            <th>Ğ’Ñ–Ğ´Ğ´Ñ–Ğ»</th>
                        </tr>
                    </thead>
                    <tbody>`;
            
            mockEmails.forEach(item => {
                html += `
                    <tr>
                        <td>${item.user}</td>
                        <td><a href="mailto:${item.email}">${item.email}</a></td>
                        <td>${item.department}</td>
                    </tr>
                `;
            });

            html += `</tbody></table></div>`;
            container.innerHTML = html;
        }


        // --- ĞĞ¡ĞĞĞ’ĞĞĞ¯ Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ¯: Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ€Ğ°ÑÑÑ‹Ğ»ĞºĞ¸ (Ğ’ĞĞ¡Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•ĞĞ Ğ˜ĞĞ”Ğ˜ĞšĞĞ¦Ğ˜Ğ¯) ---
        async function loadConfig() {
            const configDiv = document.getElementById('configTableContainer');
            const statusDiv = document.getElementById('configStatus');
            
            // Ğ’ĞĞ¡Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•ĞĞ: Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ÑĞ¾ ÑĞ¿Ğ¸Ğ½Ğ½ĞµÑ€Ğ¾Ğ¼
            statusDiv.innerHTML = `<div class="inline-spinner-wrapper"><div class="inline-spinner"></div> Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ ĞºĞ¾Ğ½Ñ„Ñ–Ğ³ÑƒÑ€Ğ°Ñ†Ñ–Ñ—...</div>`;
            statusDiv.style.display = 'block';

            // ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿ĞµÑ€ĞµÑ€Ğ°ÑÑ‡ĞµÑ‚ Ğ²Ñ‹ÑĞ¾Ñ‚Ñ‹, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸Ğ½Ğ½ĞµÑ€
            const content = document.getElementById('configContent');
            if (content && content.classList.contains('open')) {
                // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ‘Ğ£Ğ¤Ğ•Ğ Ğ
                content.style.maxHeight = (content.scrollHeight + 50) + "px"; 
            }


            try {
                // Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğº GAS Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ JSON
                const resp = await fetch(WEBAPP_URL + '?getConfig=1'); 
                const dataText = await resp.text(); // ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼ TEXT Ğ´Ğ»Ñ CORS
                const data = JSON.parse(dataText);
                
                if (!data || data.length === 0) {
                    configDiv.innerHTML = '<p>ĞšĞ¾Ğ½Ñ„Ñ–Ğ³ÑƒÑ€Ğ°Ñ†Ñ–Ñ Ñ€Ğ¾Ğ·ÑĞ¸Ğ»ĞºĞ¸ Ğ½Ğµ Ğ·Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ° Ğ°Ğ±Ğ¾ Ğ¿ÑƒÑÑ‚Ğ°.</p>';
                } else {
                    renderConfigTable(data, configDiv);
                    // Ğ Ğ°Ğ·Ğ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ°ĞºĞºĞ¾Ñ€Ğ´ĞµĞ¾Ğ½ Ğ¿Ğ¾ÑĞ»Ğµ Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³Ğ° Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹
                    setTimeout(() => {
                        // Ğ’ĞĞ–ĞĞ: ĞŸĞ¾ÑĞ»Ğµ Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³Ğ° Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ²Ñ‹ÑĞ¾Ñ‚Ğ° ÑƒĞ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ‚ÑÑ, Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼Ñƒ 
                        // Ğ¿ĞµÑ€ĞµÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ maxHeight, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¿Ğ¾Ğ¼ĞµÑÑ‚Ğ¸Ğ»Ğ°ÑÑŒ
                        if (content && content.classList.contains('open')) {
                            // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ‘Ğ£Ğ¤Ğ•Ğ Ğ
                            content.style.maxHeight = (content.scrollHeight + 50) + "px"; 
                            document.getElementById('configHeader').classList.add('active');
                            document.getElementById('configHeader').querySelector('.accordion-icon').innerHTML = 'â–²';
                        }
                    }, 50);
                }
                
                // Ğ’ĞĞ¡Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•ĞĞ: Ğ¡ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ¿Ğ¾ÑĞ»Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ¹ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸
                statusDiv.style.display = 'none';

            } catch (err) {
                // Ğ’ ÑĞ»ÑƒÑ‡Ğ°Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Ğ°ĞºĞºĞ¾Ñ€Ğ´ĞµĞ¾Ğ½Ğ°
                statusDiv.innerHTML = '<p style="color: var(--status-error);">âš ï¸ ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ– ĞºĞ¾Ğ½Ñ„Ñ–Ğ³ÑƒÑ€Ğ°Ñ†Ñ–Ñ—. ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€Ñ‚Ğµ Ğ“ĞS.</p>';
                configDiv.innerHTML = '';
                console.error('ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° ĞºĞ¾Ğ½Ñ„Ñ–Ğ³ÑƒÑ€Ğ°Ñ†Ñ–Ñ—:', err);
                
                // Ğ Ğ°ÑÑ‚ÑĞ³Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ°ĞºĞºĞ¾Ñ€Ğ´ĞµĞ¾Ğ½, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ
                const content = document.getElementById('configContent');
                if (content && content.classList.contains('open')) {
                    // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ‘Ğ£Ğ¤Ğ•Ğ Ğ
                    content.style.maxHeight = (content.scrollHeight + 50) + "px";
                }
            }
        }

        // --- Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ•: Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ (Ğ£Ğ±Ñ€Ğ°Ğ½ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº H3) ---
        function renderConfigTable(data, container) {
            let html = `
                <div class="table-scroll">
                <table class="config-table">
                    <thead>
                        <tr>
                            <th>ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡</th>
                            <!-- <th>Email</th> -->
                            <th class="status-col">ĞÑ‚Ñ€Ğ¸Ğ¼ÑƒĞ²Ğ°Ñ‚Ğ¸ Email</th>
							<th class="status-col">ĞÑ‚Ñ€Ğ¸Ğ¼ÑƒĞ²Ğ°Ñ‚Ğ¸ PUSH</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach((row, index) => {
                const isEmailActive = row.flag === '1';
                const isPushActive = row.flagP === '1'; 
                // ĞĞ¾Ğ¼ĞµÑ€ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ğ² Google Sheet: index + 2 (Ñ‚.Ğº. Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ A2)
                const sheetRow = index + 2; 

				// Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ Email (ĞšĞ¾Ğ»Ğ¾Ğ½ĞºĞ° E)
Â  Â  Â  Â  Â  Â  Â  Â  const emailIcon = isEmailActive ? 'ğŸŸ¢' : 'ğŸ”´';
Â  Â  Â  Â  Â  Â  Â  Â  const emailClass = isEmailActive ? 'active' : 'inactive';
                
                // Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ Push (ĞšĞ¾Ğ»Ğ¾Ğ½ĞºĞ° F)
                const pushIcon = isPushActive ? 'ğŸŸ¢' : 'ğŸ”´';
                const pushClass = isPushActive ? 'active' : 'inactive';

                html += `
                     <tr class="row-${isEmailActive ? 'active' : 'inactive'}">
                        <td>${row.user_a}</td>
                        <!-- <td class="email-col">${row.email}</td> -->
                        <td class="status-col">
                            <span class="status-indicator status-${emailClass}" 
                                  onclick="toggleEmailStatus(${sheetRow}, '${row.flag}', event)">
                                ${emailIcon} ${isEmailActive ? 'Ğ¢Ğ°Ğº' : 'ĞÑ–'}
                            </span>
                        </td>
						<td class="status-col">
                            <span class="status-indicator status-${pushClass}" 
                                  onclick="togglePushStatus(${sheetRow}, '${row.flagP}', event)">
                                 ${pushIcon} ${isPushActive ? 'Ğ¢Ğ°Ğº' : 'ĞÑ–'}
                            </span>
                        </td>
                    </tr>
                `;
            });

            html += `</tbody></table></div>`;
            container.innerHTML = html;
        }

        // --- Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ---
        window.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark');
            }            
            document.getElementById('buildVersion').textContent = getBuildVersion(); 
            // Ğ’ĞĞ¡Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•ĞĞ: Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ
            loadConfig(); 
            loadEmailList();
        });
        
        // --- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ getBuildVersion ---
        function getBuildVersion() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            return `v${year}.${month}.${day}.${hours}${minutes}`; 
        }

    </script>
</body>
</html>
