<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        
        <!-- ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ¼ĞµĞ½Ñ -->
        <button class="menu-button" onclick="toggleMenu()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M4 6H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M4 12H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>

        <div class="form-wrapper">

            <!-- Ğ‘Ğ¾ĞºĞ¾Ğ²Ğ¾Ğµ Ğ¼ĞµĞ½Ñ (Ğ£Ğ±Ñ€Ğ°Ğ½Ğ¾, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸Ğ·Ğ±ĞµĞ¶Ğ°Ñ‚ÑŒ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ĞºĞ¾Ğ´Ğ°) -->
            <div class="side-menu" id="sideMenu">
                <button class="close-button" onclick="toggleMenu()">âŒ</button>
                <ul>
                    <li><a href="index.html">ğŸ  Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğ°</a></li> 
                    <li><a href="history.html">ğŸ“œ Ğ†ÑÑ‚Ğ¾Ñ€Ñ–Ñ</a></li> 
                    <li><a href="stats.html">ğŸ“ˆ Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°</a></li>
                    <li><a href="settings.html">âš™ï¸ ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ</a></li>
                    <li><a href="#" onclick="closeWebView()">ğŸšª Ğ’Ğ¸Ñ…Ñ–Ğ´</a></li>
                </ul>
                <button type="button" class="theme-toggle" onclick="toggleTheme()">ğŸŒ“ Ğ—Ğ¼Ñ–Ğ½Ğ¸Ñ‚Ğ¸ Ñ‚ĞµĞ¼Ñƒ</button>
            </div>


            <!-- ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğµ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ -->
            <h2>Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ– Ğ½Ğ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ</h2>

            <!-- ĞĞšĞšĞĞ Ğ”Ğ•ĞĞ 1: ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ ÑĞ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½ÑŒ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ² -->
            <div class="accordion-item">
                <div class="accordion-header" id="configHeader" onclick="toggleAccordion('configContent')">
                    ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ ÑĞ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½ÑŒ
                    <span class="accordion-icon">â–¼</span>
                </div>
                <div class="accordion-content open" id="configContent">
                    <div id="configTableContainer" style="text-align: left;">
                        <!-- Ğ¡ÑĞ´Ğ° Ğ±ÑƒĞ´ĞµÑ‚ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ° Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° -->
                    </div>
                    <!-- ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ Ğ´Ğ»Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° (ĞŸĞ•Ğ Ğ•ĞœĞ•Ğ©Ğ•Ğ ĞŸĞĞ” Ğ¢ĞĞ‘Ğ›Ğ˜Ğ¦Ğ£) -->
                    <div id="configStatus" class="status-message" style="text-align: center; margin-top: 20px;"></div>
                </div>
            </div>
            <!-- ĞšĞĞĞ•Ğ¦ ĞĞšĞšĞĞ Ğ”Ğ•ĞĞĞ 1 -->
            
            <!-- ĞĞĞ’Ğ«Ğ™ ĞĞšĞšĞĞ Ğ”Ğ•ĞĞ 2: Email ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ² -->
            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion('emailContent')">
                    Email ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ²
                    <span class="accordion-icon">â–¼</span>
                </div>
                <!-- Ğ£Ğ±Ñ€Ğ°Ğ½ ĞºĞ»Ğ°ÑÑ 'open', Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ±Ğ»Ğ¾Ğº Ğ±Ñ‹Ğ» ÑĞ²ĞµÑ€Ğ½ÑƒÑ‚ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ -->
                <div class="accordion-content" id="emailContent">
                    <div id="emailListContainer">
                        <!-- Ğ¡ÑĞ´Ğ° Ğ±ÑƒĞ´ĞµÑ‚ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½ ÑĞ¿Ğ¸ÑĞ¾Ğº email'Ğ¾Ğ² -->
                        <!-- Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¾ Ğ¿Ñ€Ğ¸ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ² JS -->
                    </div>
                </div>
            </div>
            <!-- ĞšĞĞĞ•Ğ¦ ĞĞšĞšĞĞ Ğ”Ğ•ĞĞĞ 2 -->
            
           </div>
    </div>



    <script>
        const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbxiFpwrkbINal0wGhPxMy0wd452HF3Q64yPqXyntLG9HC7gIus6zY2hQoqrcWH_EROf/exec';
        
        // Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ´Ğ»Ñ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
        let appData = null;
        
        // --- Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ ---
        function toggleTheme() {
            const isDark = document.body.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        // Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ¯: ĞŸĞ»Ğ°Ğ²Ğ½Ğ¾Ğµ ÑĞ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ/Ñ€Ğ°Ğ·Ğ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ
        function toggleAccordion(contentId) {
            const content = document.getElementById(contentId);
            const header = content.previousElementSibling; 
            const icon = header.querySelector('.accordion-icon');
            
            if (contentId === 'configContent' && content.classList.contains('open')) {
                const statusDiv = document.getElementById('configStatus');
                statusDiv.style.display = 'none';
            }

            content.classList.toggle('open');
            header.classList.toggle('active');

            if (content.classList.contains('open')) {
                // Ğ Ğ°Ğ·Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ: ÑƒÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ max-height Ğ½Ğ° Ñ„Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºÑƒÑ Ğ²Ñ‹ÑĞ¾Ñ‚Ñƒ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ° + Ğ‘Ğ£Ğ¤Ğ•Ğ 
                content.style.maxHeight = (content.scrollHeight + 50) + "px"; 
                icon.innerHTML = 'â–²';
            } else {
                // Ğ¡Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ
                content.style.maxHeight = '0';
                icon.innerHTML = 'â–¼';
            }
        }

        function toggleMenu() {
            const menu = document.getElementById("sideMenu");
            menu.classList.toggle("open");
        }
        
        function closeWebView() {
            console.log("Attempting to close WebView...");
            if (typeof Android !== 'undefined' && Android.closeApp) {
                Android.closeApp();
            } else {
                console.warn("Native Android closeApp interface not found. Cannot close application.");
            }
        }
        
        
        /* --- Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜: ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Email Ğ¸ PUSH --- */
        
        // --- ĞĞ±Ñ‰Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ğ½Ğ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ---
        async function updateConfigStatus(sheetRow, currentFlag, targetColumn, event) {
            // targetColumn: 5 Ğ´Ğ»Ñ Email (E) Ğ¸Ğ»Ğ¸ 6 Ğ´Ğ»Ñ PUSH (F)
            
            // ĞŸÑ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ ĞºĞ»Ğ¸ĞºĞ° Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ€Ğ°Ğ·
Â  Â  Â  Â  Â  Â  if (event.target.classList.contains('status-loading')) return;

Â  Â  Â  Â  Â  Â  const statusDiv = document.getElementById('configStatus');
Â  Â  Â  Â  Â  Â  const newStatus = currentFlag === '1' ? '0' : '1';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Ğ’ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ½Ğ° ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğµ
Â  Â  Â  Â  Â  Â  const indicator = event.target;
Â  Â  Â  Â  Â  Â  const originalHTML = indicator.innerHTML;
Â  Â  Â  Â  Â  Â  indicator.innerHTML = 'ğŸ”„';
Â  Â  Â  Â  Â  Â  indicator.classList.add('status-loading');
Â  Â  Â  Â  Â  Â Â 
            statusDiv.innerHTML = `<span class="inline-spinner-wrapper"><span class="inline-spinner"></span> ĞĞ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑÑƒ Ñ€ÑĞ´ĞºĞ° ${sheetRow} Ñƒ ĞºĞ¾Ğ»Ğ¾Ğ½Ñ†Ñ– ${targetColumn}...</span>`;
            statusDiv.style.display = 'block';

            // ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿ĞµÑ€ĞµÑ€Ğ°ÑÑ‡ĞµÑ‚ Ğ²Ñ‹ÑĞ¾Ñ‚Ñ‹, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€
            const content = document.getElementById('configContent');
            if (content && content.classList.contains('open')) {
                content.style.maxHeight = (content.scrollHeight + 50) + "px"; 
            }

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const formData = new FormData();
Â  Â  Â  Â  Â  Â  Â  Â  formData.append('updateConfig', '1');
Â  Â  Â  Â  Â  Â  Â  Â  formData.append('row', sheetRow);Â 
Â  Â  Â  Â  Â  Â  Â  Â  formData.append('status', newStatus);
                formData.append('column', targetColumn); 

Â  Â  Â  Â  Â  Â  Â  Â  const resp = await fetch(WEBAPP_URL, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: formData
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const responseText = await resp.text();

Â  Â  Â  Â  Â  Â  Â  Â  if (responseText.includes('Success')) {
                    // Ğ’Ñ‹Ğ²Ğ¾Ğ´Ğ¸Ğ¼ ÑƒÑĞ¿ĞµÑ…
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.innerHTML = 'âœ… Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ ÑƒÑĞ¿Ñ–ÑˆĞ½Ğ¾.';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
                    // ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await loadConfig();Â 
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(responseText);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.innerHTML = `<p style="color: var(--status-error);">âš ï¸ ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ: ${err.message || 'ĞĞµĞ²Ñ–Ğ´Ğ¾Ğ¼Ğ° Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ°'}</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  console.error('ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° POST-Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñƒ:', err);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ĞÑ‚ĞºĞ°Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ UI Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞµ
Â  Â  Â  Â  Â  Â  Â  Â  indicator.innerHTML = originalHTML;
Â  Â  Â  Â  Â  Â  Â  Â  indicator.classList.remove('status-loading');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Ğ¡ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ñ‡ĞµÑ€ĞµĞ· ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ
Â  Â  Â  Â  Â  Â  setTimeout(() => { 
                statusDiv.style.display = 'none'; 
                // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ²Ñ‹ÑĞ¾Ñ‚Ñƒ Ğ°ĞºĞºĞ¾Ñ€Ğ´ĞµĞ¾Ğ½Ğ° Ğ¿Ğ¾ÑĞ»Ğµ ÑĞºÑ€Ñ‹Ñ‚Ğ¸Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
                if (content && content.classList.contains('open')) {
                    content.style.maxHeight = (content.scrollHeight + 50) + "px"; 
                }
            }, 3000);
Â  Â  Â  Â  }
        
        // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ¸ "ĞÑ‚Ñ€Ğ¸Ğ¼ÑƒĞ²Ğ°Ñ‚Ğ¸ Email" (ĞšĞ¾Ğ»Ğ¾Ğ½ĞºĞ° E, Ğ¸Ğ½Ğ´ĞµĞºÑ 5)
        async function toggleEmailStatus(sheetRow, currentFlag, event) {
            await updateConfigStatus(sheetRow, currentFlag, 5, event);
        }

        // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ¸ "ĞÑ‚Ñ€Ğ¸Ğ¼ÑƒĞ²Ğ°Ñ‚Ğ¸ PUSH" (ĞšĞ¾Ğ»Ğ¾Ğ½ĞºĞ° F, Ğ¸Ğ½Ğ´ĞµĞºÑ 6)
        async function togglePushStatus(sheetRow, currentFlag, event) {
            await updateConfigStatus(sheetRow, currentFlag, 6, event);
        }
        
        /* --- ĞĞĞ’ĞĞ¯ Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ¯ Ğ Ğ•ĞĞ”Ğ•Ğ Ğ˜ĞĞ“Ğ EMAIL-Ğ¡ĞŸĞ˜Ğ¡ĞšĞ --- */
        
        // Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ email-Ğ°Ğ´Ñ€ĞµÑĞ¾Ğ²: Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ user_a Ğ¸ email
        function renderEmailListTable(data, container) {
            let html = `
                <div class="table-scroll">
                <table class="config-table">
                    <thead>
                        <tr>
                            <th>ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡</th>
                            <th>Email</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach((row) => {
                // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ¸ B (user_a) Ğ¸ D (email)
                html += `
                    <tr>
                        <td>${row.user_a}</td>
                        <td><a href="mailto:${row.email}" class="email-link">${row.email}</a></td>
                    </tr>
                `;
            });

            html += `</tbody></table></div>`;
            container.innerHTML = html;
        }


        // --- ĞĞ¡ĞĞĞ’ĞĞĞ¯ Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ¯: Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ€Ğ°ÑÑÑ‹Ğ»ĞºĞ¸ ---
        async function loadConfig() {
            const configDiv = document.getElementById('configTableContainer');
            const emailListDiv = document.getElementById('emailListContainer');
            const statusDiv = document.getElementById('configStatus');
            
            // Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ´Ğ»Ñ ĞĞšĞšĞĞ Ğ”Ğ•ĞĞĞ 1 (Ğ’ĞĞ¡Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•ĞĞ Ğ¡ inline-spinner-wrapper)
            statusDiv.innerHTML = `<span class="inline-spinner-wrapper"><span class="inline-spinner"></span> Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ ĞºĞ¾Ğ½Ñ„Ñ–Ğ³ÑƒÑ€Ğ°Ñ†Ñ–Ñ—...</span>`; 
            statusDiv.style.display = 'block';

            // Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ´Ğ»Ñ ĞĞšĞšĞĞ Ğ”Ğ•ĞĞĞ 2 (Ğ’ĞĞ¡Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•ĞĞ Ğ¡ inline-spinner-wrapper)
            emailListDiv.innerHTML = `
                <p style="text-align: center; color: var(--text-color);">
                    <span class="inline-spinner-wrapper"><span class="inline-spinner"></span> Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ ÑĞ¿Ğ¸ÑĞºÑƒ email'Ñ–Ğ²...</span>
                </p>`;
            
            // ĞĞºĞºĞ¾Ñ€Ğ´ĞµĞ¾Ğ½ 1
            const contentConfig = document.getElementById('configContent');
            if (contentConfig && contentConfig.classList.contains('open')) {
                contentConfig.style.maxHeight = (contentConfig.scrollHeight + 50) + "px"; 
            }

            // ĞĞºĞºĞ¾Ñ€Ğ´ĞµĞ¾Ğ½ 2
            const contentEmail = document.getElementById('emailContent');
            if (contentEmail && contentEmail.classList.contains('open')) {
                contentEmail.style.maxHeight = (contentEmail.scrollHeight + 50) + "px";
            }


            try {
                // Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğº GAS Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ JSON
                const resp = await fetch(WEBAPP_URL + '?getConfig=1'); 
                const dataText = await resp.text(); // ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼ TEXT Ğ´Ğ»Ñ CORS
                const data = JSON.parse(dataText);
                
                appData = data; // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾

                if (!appData || appData.length === 0) {
                    configDiv.innerHTML = '<p>ĞšĞ¾Ğ½Ñ„Ñ–Ğ³ÑƒÑ€Ğ°Ñ†Ñ–Ñ Ñ€Ğ¾Ğ·ÑĞ¸Ğ»ĞºĞ¸ Ğ½Ğµ Ğ·Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ° Ğ°Ğ±Ğ¾ Ğ¿ÑƒÑÑ‚Ğ°.</p>';
                    emailListDiv.innerHTML = '<p style="text-align: center;">Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº email Ğ½Ğµ Ğ·Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾.</p>';
                } else {
                    // Ğ Ğ•ĞĞ”Ğ•Ğ Ğ˜ĞĞ“ ĞĞšĞšĞĞ Ğ”Ğ•ĞĞĞ 1
                    renderConfigTable(appData, configDiv);
                    
                    // Ğ Ğ•ĞĞ”Ğ•Ğ Ğ˜ĞĞ“ ĞĞšĞšĞĞ Ğ”Ğ•ĞĞĞ 2
                    renderEmailListTable(appData, emailListDiv);

                    // Ğ Ğ°Ğ·Ğ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ°ĞºĞºĞ¾Ñ€Ğ´ĞµĞ¾Ğ½ 1 Ğ¿Ğ¾ÑĞ»Ğµ Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³Ğ°
                    setTimeout(() => {
                        if (contentConfig && contentConfig.classList.contains('open')) {
                            contentConfig.style.maxHeight = (contentConfig.scrollHeight + 50) + "px"; 
                            document.getElementById('configHeader').classList.add('active');
                            document.getElementById('configHeader').querySelector('.accordion-icon').innerHTML = 'â–²';
                        }
                    }, 50);
                }
                
                // Ğ¡ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ¿Ğ¾ÑĞ»Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ¹ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸
                statusDiv.style.display = 'none';

            } catch (err) {
                // Ğ’ ÑĞ»ÑƒÑ‡Ğ°Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Ğ°ĞºĞºĞ¾Ñ€Ğ´ĞµĞ¾Ğ½Ğ° 1
                statusDiv.innerHTML = '<p style="color: var(--status-error);">âš ï¸ ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ– ĞºĞ¾Ğ½Ñ„Ñ–Ğ³ÑƒÑ€Ğ°Ñ†Ñ–Ñ—. ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€Ñ‚Ğµ Ğ“ĞS.</p>';
                configDiv.innerHTML = '';
                console.error('ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° ĞºĞ¾Ğ½Ñ„Ñ–Ğ³ÑƒÑ€Ğ°Ñ†Ñ–Ñ—:', err);
                
                // Ğ¡Ğ±Ñ€Ğ¾Ñ Ğ»Ğ¾Ğ°Ğ´ĞµÑ€Ğ° Ğ´Ğ»Ñ Ğ°ĞºĞºĞ¾Ñ€Ğ´ĞµĞ¾Ğ½Ğ° 2
                emailListDiv.innerHTML = '<p style="text-align: center; color: var(--status-error);">âš ï¸ ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ ÑĞ¿Ğ¸ÑĞºÑƒ email\'Ñ–Ğ².</p>';

                // Ğ Ğ°ÑÑ‚ÑĞ³Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ°ĞºĞºĞ¾Ñ€Ğ´ĞµĞ¾Ğ½Ñ‹, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ
                if (contentConfig && contentConfig.classList.contains('open')) {
                    contentConfig.style.maxHeight = (contentConfig.scrollHeight + 50) + "px";
                }
                if (contentEmail && contentEmail.classList.contains('open')) {
                    contentEmail.style.maxHeight = (contentEmail.scrollHeight + 50) + "px";
                }
            }
        }

        // --- Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ•: Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ---
        function renderConfigTable(data, container) {
            let html = `
                <div class="table-scroll">
                <table class="config-table">
                    <thead>
                        <tr>
                            <th>ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡</th>
                            <!-- <th>Email</th> -->
                            <th class="status-col">ĞÑ‚Ñ€Ğ¸Ğ¼ÑƒĞ²Ğ°Ñ‚Ğ¸ Email</th>
							<th class="status-col">ĞÑ‚Ñ€Ğ¸Ğ¼ÑƒĞ²Ğ°Ñ‚Ğ¸ PUSH</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach((row, index) => {
                const isEmailActive = row.flag === '1';
                const isPushActive = row.flagP === '1'; 
                // ĞĞ¾Ğ¼ĞµÑ€ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ğ² Google Sheet: index + 2 (Ñ‚.Ğº. Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ A2)
                const sheetRow = index + 2; 

				// Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ Email (ĞšĞ¾Ğ»Ğ¾Ğ½ĞºĞ° E)
Â  Â  Â  Â  Â  Â  Â  Â  const emailIcon = isEmailActive ? 'ğŸŸ¢' : 'ğŸ”´';
Â  Â  Â  Â  Â  Â  Â  Â  const emailClass = isEmailActive ? 'active' : 'inactive';
                
                // Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ Push (ĞšĞ¾Ğ»Ğ¾Ğ½ĞºĞ° F)
                const pushIcon = isPushActive ? 'ğŸŸ¢' : 'ğŸ”´';
                const pushClass = isPushActive ? 'active' : 'inactive';

                html += `
                     <tr class="row-${isEmailActive ? 'active' : 'inactive'}">
                        <td>${row.user_a}</td>
                        <!-- <td class="email-col">${row.email}</td> -->
                        <td class="status-col">
                            <span class="status-indicator status-${emailClass}" 
                                  onclick="toggleEmailStatus(${sheetRow}, '${row.flag}', event)">
                                ${emailIcon} ${isEmailActive ? 'Ğ¢Ğ°Ğº' : 'ĞÑ–'}
                            </span>
                        </td>
						<td class="status-col">
                            <span class="status-indicator status-${pushClass}" 
                                  onclick="togglePushStatus(${sheetRow}, '${row.flagP}', event)">
                                 ${pushIcon} ${isPushActive ? 'Ğ¢Ğ°Ğº' : 'ĞÑ–'}
                            </span>
                        </td>
                    </tr>
                `;
            });

            html += `</tbody></table></div>`;
            container.innerHTML = html;
        }

        // --- Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ---
        window.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark');
            }            
			
            loadConfig(); 
        });

    </script>
</body>
</html>
