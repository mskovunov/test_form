<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–Ü—Å—Ç–æ—Ä—ñ—è –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    
	<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ü–ï–†–ï–î –æ—Å–Ω–æ–≤–Ω—ã–º —Å–∫—Ä–∏–ø—Ç–æ–º -->
    <script src="config.js"></script>
	
    <script>
        // –°–ø–∏—Å–æ–∫ –º–µ—Å—è—Ü–µ–≤, –Ω–∞ –æ—Å–Ω–æ–≤–µ –í–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∑–∞ 2025 –≥–æ–¥
        const MONTHS = [
		    { value: "2025-10", text: "–ñ–æ–≤—Ç–µ–Ω—å 2025" }, // <--- –î–û–ë–ê–í–õ–ï–ù–û
            { value: "2025-09", text: "–í–µ—Ä–µ—Å–µ–Ω—å 2025" },
            { value: "2025-08", text: "–°–µ—Ä–ø–µ–Ω—å 2025" },
            { value: "2025-07", text: "–õ–∏–ø–µ–Ω—å 2025" },
            { value: "2025-06", text: "–ß–µ—Ä–≤–µ–Ω—å 2025" },
            { value: "2025-05", text: "–¢—Ä–∞–≤–µ–Ω—å 2025" },
            { value: "2025-04", text: "–ö–≤—ñ—Ç–µ–Ω—å 2025" },
            { value: "2025-03", text: "–ë–µ—Ä–µ–∑–µ–Ω—å 2025" },
            { value: "2025-02", text: "–õ—é—Ç–∏–π 2025" },
        ];

        function populateMonthSelector() {
            const selector = document.getElementById('monthSelector');
            
          

            // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Å—è—Ü—ã
            MONTHS.forEach(month => {
                const option = document.createElement('option');
                option.value = month.value;
                option.textContent = month.text;
                selector.appendChild(option);
            });
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü (–°–µ–Ω—Ç—è–±—Ä—å) –∫–∞–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            selector.value = MONTHS[0].value;
        }

       // history.html (–≤–Ω—É—Ç—Ä–∏ <script>)

async function loadHistory() {
    const historyDiv = document.getElementById('history');
    const statusDiv = document.getElementById('loadingStatus');
    const monthSelector = document.getElementById('monthSelector');
    
    const selectedMonth = monthSelector.value;
    const monthName = monthSelector.options[monthSelector.selectedIndex].text;

    statusDiv.innerHTML = `‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –∑–∞ ${monthName}...`;
    statusDiv.style.display = 'block';
    historyDiv.innerHTML = ''; 

    let url = WEBAPP_URL + '?history=1';
    
    // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–µ—Å—è—Ü, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ URL
    if (selectedMonth) {
        url += `&month=${selectedMonth}`;
    } else {
        // –ò–ó–ú–ï–ù–ï–ù–ò–ï –ó–î–ï–°–¨: –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –≤—Å—è –∏—Å—Ç–æ—Ä–∏—è
        statusDiv.innerHTML = `‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —É—Å—ñ—î—ó —ñ—Å—Ç–æ—Ä—ñ—ó...`; 
    }

    try {
        const resp = await fetch(url);
        const html = await resp.text();
        
        // ... (–æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø—É—Å—Ç–æ—Ç—É) ...

        if (html.trim() === '' || html.length < 50) { 
             // –≠—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ "–£—Å—è —ñ—Å—Ç–æ—Ä—ñ—è", –∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç.
             historyDiv.innerHTML = `<p style="text-align: center; color: var(--text-color); margin-top: 30px;">–ó–∞–ø–∏—Å—ñ–≤ –∑–∞ ${monthName} –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</p>`;
        } else {
             historyDiv.innerHTML = html;
        }

        statusDiv.style.display = 'none';

    } catch (err) {
        statusDiv.innerHTML = '<p>‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —ñ—Å—Ç–æ—Ä—ñ—ó.</p>';
        console.error('–ü–æ–º–∏–ª–∫–∞ —ñ—Å—Ç–æ—Ä—ñ—ó:', err);
    }
}
        
        function toggleTheme() {
            const isDark = document.body.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        function toggleMenu() {
            const menu = document.getElementById("sideMenu");
            menu.classList.toggle("open");
        }

        window.addEventListener('DOMContentLoaded', () => {
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Ç–µ–º—ã
            if (localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark');
            }
            
            populateMonthSelector(); 
            loadHistory(); // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –º–µ—Å—è—Ü–∞
        });
    </script>
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-N0T0138X0Q"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'G-N0T0138X0Q');
	</script>
</head>
<body>
    <div class="container">
        <button class="menu-button" onclick="toggleMenu()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M4 6H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M4 12H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>

        <div class="form-wrapper">
            <div class="side-menu" id="sideMenu">
                <button class="close-button" onclick="toggleMenu()">‚ùå</button>
                <ul>
                    <li><a href="index.html">üè† –ì–æ–ª–æ–≤–Ω–∞</a></li> 
                    <li><a href="history.html">üìú –Ü—Å—Ç–æ—Ä—ñ—è</a></li> 
                    <li><a href="stats.html">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a></li>
                    <li><a href="settings.html">‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</a></li>
					<li><a href="#" onclick="handleExit()">üö™ –í–∏—Ö—ñ–¥</a></li> 
                </ul>
                <button type="button" class="theme-toggle" onclick="toggleTheme()">üåì –ó–º—ñ–Ω–∏—Ç–∏ —Ç–µ–º—É</button>
            </div>

            <h2>–Ü—Å—Ç–æ—Ä—ñ—è –ø–µ—Ä–µ–¥–∞—á—ñ –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤</h2>
            
            <div style="margin-bottom: 20px; text-align: left;">
                <label for="monthSelector" style="font-weight: bold; margin-bottom: 5px;">–í–∏–±—Ä–∞—Ç–∏ –ø–µ—Ä—ñ–æ–¥:</label>
                <select id="monthSelector" onchange="loadHistory()">
                    </select>
            </div>
            
            <div id="loadingStatus" style="display:none; text-align:center; padding: 20px;"></div>
            
            <div id="history"></div>

        </div>
    </div>
	
	<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>	
	<script src="./firebase-init.js"></script>
	
	<script>
		// --- –§–£–ù–ö–¶–ò–Ø: –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã (Logout) ---
		async function handleLogout() {
			try {
				await auth.signOut();
				console.log("–£—Å–ø–µ—à–Ω—ã–π –≤—ã—Ö–æ–¥ –∏–∑ Firebase.");
				
				// –ü–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
				window.location.replace('auth.html'); 
				
			} catch (error) {
				console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ Firebase:", error);
				alert("–ü–æ–º–∏–ª–∫–∞ –≤–∏—Ö–æ–¥—É: " + error.message);
			}
		}
		/* --- –î–û–ë–ê–í–õ–ï–ù–û: –§–£–ù–ö–¶–ò–Ø –ó–ê–ö–†–´–¢–ò–Ø WEBVIEW --- */
		function closeWebView() {
			console.log("Attempting to close WebView...");
			// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ Android-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
			if (typeof Android !== 'undefined' && Android.closeApp) {
				Android.closeApp();
			} else {
				// Fallback –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞
				console.warn("Native Android closeApp interface not found. Cannot close application.");
			}
		}
		
		// –ù–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –º–µ–Ω—é "–í–∏—Ö—ñ–¥"
		function handleExit() {
			// –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å "–í–∏—Ö—ñ–¥":
			// 1. –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –≤—ã—Ö–æ–¥ –∏–∑ —Å–µ—Å—Å–∏–∏:
			handleLogout(); 
			
			// 2. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–∫–∞–∫ –≤ –≤–∞—à–µ–º —Å—Ç–∞—Ä–æ–º –∫–æ–¥–µ):
			// closeWebView();
		}
	
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    auth.onAuthStateChanged((user) => {
        if (!user) {
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
            console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞.");
            // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
            window.location.replace('auth.html'); 
        } else {
            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
            console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∫–∞–∫:", user.email);
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–¥ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –∏–∑ Firestore)
        }
    });

    // // (–í–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ GAS –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∏–∂–µ —ç—Ç–æ–≥–æ –±–ª–æ–∫–∞)
	</script>
	
</body>
</html>